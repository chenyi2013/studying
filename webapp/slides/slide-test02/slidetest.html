<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ppt-normal</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobileoptimized" content="0">
    <meta name="format-detection" content="telephone=no">
    <meta name="screen-orientation" content="portrait">
    <meta name="browsermode" content="application">

    <style>
        * {
            margin: 0;
            padding: 0;
        }

        ul {
            list-style: none;
        }

        body {
            background-color: #f1f1f1;
        }

        .slides {
            position: relative;
            margin: 0;
            /*margin-left: 20px;*/
            overflow: hidden;
        }

        .slides-list {
            position: relative;
            left: 0;
            top: 0;
            /*-webkit-transition: all 0.5s ease;*/
            /*overflow: hidden;*/
        }

        .slides-animate {
            -webkit-transition: all 0.3s ease;
        }

        .slides-list li {
            float: left;
            position: absolute;
            left: 0;
            top: 0;
            text-align: center;
        }

        .slides-list img {
            width: 100%;
            vertical-align: middle;
        }

        .icon-list {
            position: absolute;
            bottom: 6px;
            left: 0;
            right: 0;
            margin: 0 auto;
            width: 300px;
            height: 8px;
            font-size: 0;
            text-align: center;
        }

        .icon-list li {
            display: inline-block;
            margin: 0 3px;
            width: 6px;
            height: 6px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 50%;
        }

        .icon-list .active {
            background: #e73736;
        }

        .slides-mask {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            z-index: 1;
            width: 100%;
            /*background: rgba(0, 0, 0, .6);*/
        }


    </style>

    <script src="../zeptomix.js"></script>
    <script>


        $(function () {


            document.body.style.mozUserSelect = 'none';
            document.body.style.webkitUserSelect = 'none';

            document.addEventListener('touchstart', function ( e ) {
                e.preventDefault();
                return false;
            }, false);


            $(window).on('load', function () {
                // alert($);
                var _slidesNormal = $('#J-slides-normal'),
                    _slidesList = _slidesNormal.find('.slides-list'),
                    _slide = _slidesList.find('li'),

                    _icon = _slidesNormal.find('.icon-list li'),

                    _slidesMask = _slidesNormal.find('.slides-mask'),


                    _offsetX = _slidesNormal.offset().left;

                    _imgW = _slidesList.find('img').width(),
                    _pageW = $('body').width()
                    ;

                var _timer;

                var _swipeCount = 0;

                // init     
                _slide.width( _pageW );
                _slidesList.width( _slide.width() * _slide.length );   
                _slidesList.height( _slide.height() );
                _slidesNormal.height( _slide.height() );
                _slidesMask.height( _slide.height() );

                for ( var i = 0, len = _slide.length; i < len; i++) {
                    $(_slide[i]).css('left', _pageW * i );
                    if ( i == len -1 ) {
                        // $(_slide[i]).css('left', -_pageW );
                    }
                }

                console.log(_slidesList.width());



                //
                //
                // 滑动到最后一张时，把第一张放到最后一张后面，叫做A
                // 当滑动到A时，瞬间再吧A重新放回第一张的初始位置
                // if ( i == len - 1 ) {
                //    $(_slide[0]).css('left', _slidesList.width() );
                // }   
                //
                function swipeLeftReset () {
                    _slidesList.removeClass('slides-animate');
                    _slidesList[0].style.webkitTransform = 'translateX(' + 0 + 'px)';
                    $(_slide[0]).css('left', 0 );
                    $(_icon[0]).addClass('active').siblings().removeClass('active');
                    _slidesList[0].removeEventListener('webkitTransitionEnd', swipeLeftReset, false);              
                }

                function swipeRightReset () {
                     _slidesList.removeClass('slides-animate');
                    _slidesList[0].style.webkitTransform = 'translateX(' + -_pageW * (len-1) + 'px)';
                    $(_slide[len-1]).css('left', _pageW*(len-1) );
                    $(_icon[len-1]).addClass('active').siblings().removeClass('active');
                    _slidesList[0].removeEventListener('webkitTransitionEnd', swipeRightReset, false);
                }
                //
                //
                //


                function animationContinue () {
                    _slidesMask.hide();
                    _slidesList[0].removeEventListener('webkitTransitionEnd', animationContinue, false);
                } 


                var _x1, _x2, _disX;
                // swipe
                for ( var i = 0, len = _slide.length; i < len; i++) {
                    (function ( i ) {

                        _slide[i].addEventListener('touchstart', function ( e ) {
                            _x1 = e.touches[0].clientX;
                            _slidesList.removeClass('slides-animate');
                        }, false);

                        _slide[i].addEventListener('touchmove', function ( e ) {
                            _x2 = e.changedTouches[e.changedTouches.length-1].clientX - _offsetX;
                            _disX = _x1 - _x2;

                            // _disX > 0 --- left
                            // _disX < 0 --- right

                            // left
                            if ( _disX > 0 ) {
                                
                                if ( i == len - 1 ) {
                                    $(_slide[0]).css('left', _slidesList.width() );
                                }                                

                                _slidesList[0].style.webkitTransform = 'translateX(' + -( _pageW*i + Math.abs(_disX) ) + 'px)';
                            }
                            // right
                            else if ( _disX < 0 ) {

                                if ( i == 0 ) {
                                    $(_slide[len-1]).css('left', -_pageW );
                                }

                                _slidesList[0].style.webkitTransform = 'translateX(' + -( _pageW*i - Math.abs(_disX) ) + 'px)';
                            } 
                        }, false);

                        _slide[i].addEventListener('touchend', function ( e ) {
                            var _endDisX = Math.abs(_disX);
                            _slidesList.addClass('slides-animate');
                            _slidesMask.show();

                            // left
                            if ( _disX > 0 ) {
                                if ( _endDisX > 50 ) {
                                    // next
                                    _slidesList[0].style.webkitTransform = 'translateX(' + -_pageW*(i+1) + 'px)';
                                    $(_icon[i+1]).addClass('active').siblings().removeClass('active');
                                    
                                    // swipe left loop start ------
                                    if ( i == len - 1 ) {
                                        _slidesList[0].addEventListener('webkitTransitionEnd', swipeLeftReset, false);
                                    }
                                    // swipe left loop end ------

                                } else {
                                    // reset
                                    _slidesList[0].style.webkitTransform = 'translateX(' + -_pageW*i + 'px)';
                                }
                            }

                            // right
                            else if ( _disX < 0 ) {
                                if ( _endDisX > 50 ) {
                                    // prev
                                    _slidesList[0].style.webkitTransform = 'translateX(' + -_pageW*(i-1) + 'px)';
                                    $(_icon[i-1]).addClass('active').siblings().removeClass('active');

                                    // swipe right loop start ------
                                    if ( i == 0 ) {
                                        _slidesList[0].addEventListener('webkitTransitionEnd', swipeRightReset, false);
                                    }
                                    // swipe right loop end ------
                                } else {
                                    // reset
                                    _slidesList[0].style.webkitTransform = 'translateX(' + -_pageW*i + 'px)';
                                }                               
                            }


                            _slidesList[0].addEventListener('webkitTransitionEnd', animationContinue, false);


                        }, false); 


                    })(i);
                  
                }

            });

        });
    </script>

</head>
<body>
    <div class="slides slides-normal" id="J-slides-normal">
        <ul class="slides-list">
            <li><a href="#"><img src="../001.jpg" alt=""></a></li>
            <li><a href="#"><img src="../002.jpg" alt=""></a></li>
            <li><a href="#"><img src="../003.jpg" alt=""></a></li>
            <li><a href="#"><img src="../004.jpg" alt=""></a></li>
        </ul>
        <ul class="icon-list">
            <li class="active"></li>
            <li></li>
            <li></li>
            <li></li>
        </ul>
        <div class="slides-mask"></div>
    </div>
    <br>
    <br>
    移动端幻灯片切换
</body>
</html>